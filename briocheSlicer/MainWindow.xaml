<Window x:Class="briocheSlicer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:Helix="clr-namespace:HelixToolkit.Wpf;assembly=HelixToolkit.Wpf"
        Title="Brioche-slicer" Height="900" Width="1600">
    <DockPanel>
        <!-- Main Toolbar -->
        <ToolBar DockPanel.Dock="Top" Height="50" Background="#F5F5F5" Padding="5">
            <Button Content="📁 Open STL..." 
                Click="OpenStl_Click"
                Padding="8,5"
                FontSize="12"
                ToolTip="Load an STL file"/>
            <Separator Width="1" Background="#CCCCCC"/>
            <Button Content="🔪 Slice" 
                Click="Slice_Click" 
                x:Name="SliceButton"
                IsEnabled="False"
                Padding="8,5"
                FontSize="12"
                ToolTip="Slice the model with current settings"/>
            <Button Content="🖨️ Print" 
                Click="Print_Click" 
                x:Name="PrintButton"
                IsEnabled="False"
                Padding="8,5"
                FontSize="12"
                ToolTip="Generate G-code and save to Downloads"/>
            <TextBlock x:Name="EstimatedTimeText" Text="Estimated Print Time: --" FontWeight="Bold" Margin="0, 10, 0, 0" HorizontalAlignment="Right"/>
        </ToolBar>

        <!-- Right Side Panel: Settings and Slice Height -->
        <Border DockPanel.Dock="Right" Width="280" Background="#F9F9F9" BorderBrush="#E0E0E0" BorderThickness="1,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                <StackPanel>
                    <!-- Print Settings Section -->
                    <GroupBox Header="Print Settings" Padding="10" Margin="0,0,0,10" 
                        Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                        <StackPanel>
                            <!-- Layer Height -->
                            <TextBlock Text="Layer Height (mm):" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="LayerHeightTextBox"
                                     Text="0,2"
                                     Padding="5,3"
                                     Margin="0,0,0,8"
                                     ToolTip="Layer height in millimeters"
                                     PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                     DataObject.Pasting="DecimalTextBox_Pasting"/>

                            <!-- Nozzle Diameter -->
                            <TextBlock Text="Nozzle Diameter (mm):" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="NozzleDiameterTextBox"
                                     Text="0,4"
                                     Padding="5,3"
                                     Margin="0,0,0,8"
                                     ToolTip="Nozzle diameter in millimeters"
                                     PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                     DataObject.Pasting="DecimalTextBox_Pasting"/>
                            <!-- Extrusion retraction Length-->
                            <TextBlock Text="Extursion Retraction Length (mm):" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="ExtrusionRetractionTextBox"
                                     Text="0,2"
                                     Padding="5,3"
                                     Margin="0,0,0,8"
                                     ToolTip="Extrusion retraction length in millimeters"
                                     PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                     DataObject.Pasting="DecimalTextBox_Pasting"/>
                            <!-- Tree Support -->
                            <CheckBox x:Name="TreeSupportCheckBox"
                                      Content="Tree Support"
                                      IsChecked="False"
                                      Margin="0,8,0,8"
                                      FontWeight="Bold"
                                      ToolTip="Enable tree support structures"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Perimeter Section -->
                    <GroupBox Header="Perimeter" Padding="10" Margin="0,0,0,10" 
                        Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                        <StackPanel>
                            <!-- Number of Shells -->
                            <TextBlock Text="Shells:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="ShellsTextBox" 
                                Text="3" 
                                Padding="5,3"
                                Margin="0,0,0,8"
                                PreviewTextInput="ShellsTextBox_PreviewTextInput"
                                TextChanged="ShellsTextBox_TextChanged"
                                ToolTip="Number of perimeter shells (minimum 1)"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Infill Section -->
                    <GroupBox Header="Infill" Padding="10" Margin="0,0,0,10" 
                        Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                        <StackPanel>
                            <!-- Number of Floors -->
                            <TextBlock Text="Floors:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="FloorsTextBox" 
                                Text="2" 
                                Padding="5,3"
                                Margin="0,0,0,8"
                                PreviewTextInput="FloorsTextBox_PreviewTextInput"
                                TextChanged="FloorsTextBox_TextChanged"
                                ToolTip="Number of floor layers (minimum 0)"/>
                            
                            <!-- Number of Roofs -->
                            <TextBlock Text="Roofs:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="RoofsTextBox" 
                                Text="2" 
                                Padding="5,3"
                                Margin="0,0,0,8"
                                PreviewTextInput="RoofsTextBox_PreviewTextInput"
                                TextChanged="RoofsTextBox_TextChanged"
                                ToolTip="Number of roof layers (minimum 0)"/>
                            
                            <!-- Infill Sparsity -->
                            <TextBlock Text="Infill Sparsity:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="InfillSparsityTextBox"
                                     Text="5"
                                     Padding="5,3"
                                     Margin="0,0,0,8"
                                     ToolTip="Infill sparsity factor (multiplied by nozzle diameter)"
                                     PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                     DataObject.Pasting="DecimalTextBox_Pasting"/>
                            
                            <!-- Support Sparsity -->
                            <TextBlock Text="Support Sparsity:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="SupportSparsityTextBox"
                                     Text="8"
                                     Padding="5,3"
                                     Margin="0,0,0,8"
                                     ToolTip="Support sparsity factor (multiplied by nozzle diameter)"
                                     PreviewTextInput="DecimalTextBox_PreviewTextInput"
                                     DataObject.Pasting="DecimalTextBox_Pasting"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Slice Height Section -->
                    <GroupBox Padding="10" Margin="0,0,0,10" 
                        Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                        <GroupBox.Header>
                            <TextBlock x:Name="SlicePreviewHeader"
                                FontWeight="Bold">
                                Slice Preview: - / -
                            </TextBlock>
                        </GroupBox.Header>
                        <StackPanel>
                            <Slider x:Name="SliceHeightSlider"
                                Orientation="Vertical"
                                TickPlacement="BottomRight"
                                ValueChanged="SliceHeightSlider_ValueChanged"
                                IsEnabled="False"
                                Height="150"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Center area: 3D View + 2D Slice View -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="0.5*" />
                </Grid.ColumnDefinitions>

                <!-- 3D Helix View -->
                <Border Grid.Column="0" Background="#1E1E1E" Margin="8">
                    <Helix:HelixViewport3D ZoomExtentsWhenLoaded="True" x:Name="View" AllowDrop="True" Drop="View_Drop">
                        <Helix:SunLight/>
                        <ModelVisual3D x:Name="scene" />
                    </Helix:HelixViewport3D>
                </Border>

                <!-- 2D Slice View -->
                <Border Grid.Column="1" Background="#0D0D0D" Margin="8" CornerRadius="8">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Canvas x:Name="SliceCanvas" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" MinHeight="200" MinWidth="200" Background="#111"/>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- Rotation Controls -->
            <Border Grid.Row="1" Grid.ColumnSpan="2" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="10">
                <GroupBox Header="Model Rotation" Padding="10" Background="White" BorderBrush="#E0E0E0" BorderThickness="1">
                    <Grid HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left/Right Rotation -->
                        <StackPanel Grid.Column="0" Orientation="Vertical">
                            <TextBlock Text="Left/Right (Y-axis)" HorizontalAlignment="Center" FontWeight="Bold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Content="◀ Left" 
                                        Click="RotateLeft_Click" 
                                        x:Name="RotateLeftButton"
                                        IsEnabled="False"
                                        Padding="10,5"
                                        Margin="5"
                                        Width="80"
                                        ToolTip="Rotate model 90° left around Y-axis"/>
                                <Button Content="Right ▶" 
                                        Click="RotateRight_Click" 
                                        x:Name="RotateRightButton"
                                        IsEnabled="False"
                                        Padding="10,5"
                                        Margin="5"
                                        Width="80"
                                        ToolTip="Rotate model 90° right around Y-axis"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Front/Back Rotation -->
                        <StackPanel Grid.Column="2" Orientation="Vertical">
                            <TextBlock Text="Front/Back (X-axis)" HorizontalAlignment="Center" FontWeight="Bold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Content="▲ Front" 
                                        Click="RotateFront_Click" 
                                        x:Name="RotateFrontButton"
                                        IsEnabled="False"
                                        Padding="10,5"
                                        Margin="5"
                                        Width="80"
                                        ToolTip="Rotate model 90° forward around X-axis"/>
                                <Button Content="Back ▼" 
                                        Click="RotateBack_Click" 
                                        x:Name="RotateBackButton"
                                        IsEnabled="False"
                                        Padding="10,5"
                                        Margin="5"
                                        Width="80"
                                        ToolTip="Rotate model 90° backward around X-axis"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </GroupBox>
            </Border>
        </Grid>

    </DockPanel>
</Window>
